---
- hosts: all
  remote_user: "{{ os_user }}"
  become: true
  gather_facts: false
  tasks:
    - name: Install Python 3 and pip
      raw: apt -y update && apt install -y python3 python3-pip python3-setuptools

    - name: Check if Python 3 is available
      raw: python3 --version
      register: python_version
      changed_when: false
      ignore_errors: true

    - name: Install python-is-python3 package
      raw: apt install -y python-is-python3
      when: python_version.rc == 0

